(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[436],{63:(e,t,r)=>{"use strict";var a=r(7260);r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},2944:(e,t,r)=>{"use strict";r.d(t,{default:()=>x});var a=r(5155),n=r(2115),o=r(2619),s=r.n(o),i=r(63),l=r(5976);let d={ask:"bg-sky-100 text-sky-700 dark:bg-sky-900/30 dark:text-sky-300 border-sky-200 dark:border-sky-800",offer_slots:"bg-violet-100 text-violet-700 dark:bg-violet-900/30 dark:text-violet-300 border-violet-200 dark:border-violet-800",confirm_booking:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-300 border-green-200 dark:border-green-800",escalate:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300 border-red-200 dark:border-red-800",none:"bg-slate-100 text-slate-600 dark:bg-slate-800/30 dark:text-slate-400 border-slate-200 dark:border-slate-700"},c={ask:"Asking",offer_slots:"Offering Times",confirm_booking:"Confirming",escalate:"Escalated",none:"—"};function u(e){let{action:t,className:r=""}=e;return(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium border ".concat(d[t]," ").concat(r),children:c[t]})}var m=r(1907),b=r(3286);function x(){let{toast:e}=(0,m.d)(),t=(0,i.useSearchParams)(),[r,o]=(0,n.useState)(""),[d,c]=(0,n.useState)(""),[x,h]=(0,n.useState)(""),[f,g]=(0,n.useState)(null),[p,k]=(0,n.useState)(null),[y,v]=(0,n.useState)([]),[w,j]=(0,n.useState)(""),[N,S]=(0,n.useState)(!1),[z,O]=(0,n.useState)(null),[E,D]=(0,n.useState)(!1),[C,I]=(0,n.useState)(!0),M=(0,n.useRef)(null),T=(0,n.useRef)(null);async function A(t){t.preventDefault(),S(!0),O(null);try{let e=await fetch("/api/leads",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:r,phone:d,email:"",jobDetails:x,channel:"web"})});if(!e.ok){let t=await e.text();throw console.error("POST /api/leads failed:",e.status,t),Error("Failed to create lead. Please try again.")}let t=await e.json();if(console.log("Create lead response:",t),t.lead&&t.lead.id){g(t.lead.id),O(null);try{let e=await fetch("/api/leads/".concat(t.lead.id,"/welcome"),{method:"POST"});if(e.ok){let r=(await e.json()).message,a=(t.lead.messages||[]).map(e=>({...e,action:e.action||"none",slotOptions:e.slotOptions}));v([r,...a])}else{console.error("Failed to fetch welcome message",await e.text());let r={id:"welcome-fallback",from:"ai",body:"Hi! I'm your AI front desk for Houston's Finest Mobile Detailing. I can help with pricing and availability — what area are you in and when do you need this done?",createdAt:new Date().toISOString(),action:"none"},a=(t.lead.messages||[]).map(e=>({...e,action:e.action||"none",slotOptions:e.slotOptions}));v([r,...a])}}catch(a){console.error("Error generating welcome message",a);let e={id:"welcome-fallback",from:"ai",body:"Hi! I'm your AI front desk for Houston's Finest Mobile Detailing. I can help with pricing and availability — what area are you in and when do you need this done?",createdAt:new Date().toISOString(),action:"none"},r=(t.lead.messages||[]).map(e=>({...e,action:e.action||"none",slotOptions:e.slotOptions}));v([e,...r])}}else throw console.error("Unexpected response structure:",t),Error("Unexpected response from server")}catch(r){console.error("Error in handleSubmit:",r);let t=r instanceof Error?r.message:"Failed to create lead. Please try again.";O(t),e({title:"Error",description:t,type:"error"})}finally{S(!1)}}async function P(t){if(!f||!t.trim()||N)return;let r={id:"temp-".concat(Date.now()),from:"user",body:t,createdAt:new Date().toISOString(),action:"none"};v(e=>[...e,r]),j(""),S(!0),O(null);try{let r=await fetch("/api/leads/".concat(f,"/messages"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t})});if(!r.ok){let e=await r.text();throw console.error("POST /api/leads/".concat(f,"/messages failed:"),r.status,e),Error("Can't send a message right now. Please try again.")}let a=await r.json();if(console.log("Message API response:",a),a.lead&&a.lead.messages){let t=a.lead.messages.map(e=>({...e,action:e.action||"none",slotOptions:e.slotOptions}));v(t),k(a.lead.status);let r=t.filter(e=>"ai"===e.from).pop();((null==r?void 0:r.action)==="confirm_booking"||"BOOKED"===a.lead.status)&&(e({title:"Booked!",description:"Your appointment has been confirmed. Calendar event created.",type:"success"}),function(){let e,t=document.createElement("canvas");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",t.style.zIndex="9999",document.body.appendChild(t);let r=t.getContext("2d");if(!r)return;t.width=window.innerWidth,t.height=window.innerHeight;let a=[],n=["#22c55e","#3b82f6","#f59e0b","#ef4444","#8b5cf6"];for(let e=0;e<100;e++)a.push({x:Math.random()*t.width,y:-10,vx:(Math.random()-.5)*3,vy:3*Math.random()+2,color:n[Math.floor(Math.random()*n.length)],size:6*Math.random()+2});let o=Date.now();!function n(){if(r){if(Date.now()-o>1500){cancelAnimationFrame(e),document.body.removeChild(t);return}r.clearRect(0,0,t.width,t.height),a.forEach(e=>{e.x+=e.vx,e.y+=e.vy,e.vy+=.1,r.fillStyle=e.color,r.fillRect(e.x,e.y,e.size,e.size)}),e=requestAnimationFrame(n)}}()}())}else throw console.error("Unexpected response structure:",a),Error("Unexpected response from server");O(null)}catch(n){console.error("Error in handleSendMessage:",n);let a=n instanceof Error?n.message:"Can't send a message right now. Please try again.";O(a),e({title:"Error",description:a,type:"error"}),v(e=>e.filter(e=>e.id!==r.id)),j(t)}finally{S(!1)}}function _(e){return new Date(e).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}return(0,n.useEffect)(()=>{var e;null==(e=M.current)||e.scrollIntoView({behavior:"smooth"})},[y]),(0,n.useEffect)(()=>{"true"===t.get("focus")&&T.current&&T.current.focus()},[t]),(0,n.useEffect)(()=>{y.some(e=>"offer_slots"===e.action)&&!E&&(I(!1),D(!0),setTimeout(()=>I(!0),700))},[y,E]),(0,n.useEffect)(()=>{function e(e){if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement)){if(!f&&["1","2","3"].includes(e.key)){let t=[{name:"Jane Smith",phone:"713-555-0101",jobDetails:"Simple wash & wax, Rice Village, tomorrow"},{name:"Mike Johnson",phone:"281-555-0202",jobDetails:"Full detail, SUV, Montrose, this weekend"},{name:"Sarah Lee",phone:"832-555-0303",jobDetails:"Interior cleaning, sedan, Heights, ASAP"}],r=parseInt(e.key)-1;t[r]&&(o(t[r].name),c(t[r].phone),h(t[r].jobDetails))}if("s"===e.key||"S"===e.key){let e=document.querySelector('[data-slot-button="0"]');e&&!e.disabled&&e.click()}("o"===e.key||"O"===e.key)&&(window.location.href="/owner")}}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[f]),(0,a.jsxs)("div",{children:[(0,a.jsx)(l.Y9,{title:"Customer Demo",showThemeToggle:!0}),b.X&&(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 bg-amber-100 dark:bg-amber-900/30 text-amber-900 dark:text-amber-300 px-3 py-1 rounded-full text-xs font-medium border border-amber-300 dark:border-amber-700",children:"MOCK MODE"}),(0,a.jsx)("div",{className:"fixed top-20 right-4 z-40 text-xs text-zinc-500 dark:text-zinc-600 text-right max-w-xs",children:"Hotkeys: 1/2/3 pick scenario • Enter start • S select slot • O owner"}),(0,a.jsx)("main",{className:"min-h-screen bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100 transition-colors flex flex-col items-center justify-center p-4 sm:p-6",children:(0,a.jsxs)("div",{className:"w-full max-w-md space-y-6",children:[(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-semibold text-center text-zinc-900 dark:text-zinc-100",children:"AI Front Desk - Lead Demo"}),f?(0,a.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 bg-white dark:bg-neutral-900 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between border-b border-zinc-200 dark:border-zinc-800 pb-2",children:[(0,a.jsx)("p",{className:"font-medium",children:"Chat with AI"}),(0,a.jsx)("button",{onClick:()=>{g(null),v([]),o(""),c(""),h(""),O(null)},className:"text-xs text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"New conversation"})]}),(0,a.jsxs)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[y.map((e,t)=>(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex ".concat("user"===e.from?"justify-end":"justify-start"),children:(0,a.jsxs)("div",{className:"max-w-[80%] rounded-lg px-3 py-2 ".concat("user"===e.from?"bg-blue-600 text-white":"bg-gray-200 dark:bg-neutral-800 text-gray-900 dark:text-gray-100"),children:[(0,a.jsx)("div",{className:"text-sm",children:e.body}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,a.jsx)("div",{className:"text-xs ".concat("user"===e.from?"text-blue-100":"text-gray-500 dark:text-gray-400"),children:new Date(e.createdAt).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})}),"ai"===e.from&&e.action&&"none"!==e.action&&(0,a.jsx)(u,{action:e.action})]})]})}),"ai"===e.from&&"offer_slots"===e.action&&e.slotOptions&&e.slotOptions.length>0&&C&&(0,a.jsxs)("div",{className:"mt-3 ml-4",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"— Suggested times —"}),(0,a.jsx)("div",{className:"flex flex-col gap-2",children:e.slotOptions.map((e,t)=>(0,a.jsxs)("button",{"data-slot-button":t,onClick:()=>{P("SELECT_SLOT:".concat(t))},disabled:N,className:"w-full flex items-center justify-between px-4 py-3 text-sm rounded-full border-2 border-violet-300 dark:border-violet-700 bg-violet-50 dark:bg-violet-900/20 text-violet-900 dark:text-violet-100 hover:bg-violet-100 dark:hover:bg-violet-900/40 hover:border-violet-400 dark:hover:border-violet-600 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed transition-all min-h-[44px] group",children:[(0,a.jsxs)("div",{className:"flex flex-col items-start",children:[(0,a.jsxs)("div",{className:"font-semibold",children:["Option ",t+1]}),(0,a.jsxs)("div",{className:"text-xs opacity-80",children:[_(e.start)," – ",_(e.end)]})]}),(0,a.jsx)("div",{className:"text-violet-600 dark:text-violet-400 group-hover:translate-x-1 transition-transform",children:"→"})]},e.id))})]})]},e.id)),N&&(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-gray-200 dark:bg-neutral-800 rounded-lg px-3 py-2",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]})})}),(0,a.jsx)("div",{ref:M})]}),z&&(0,a.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400",children:z}),(0,a.jsxs)("form",{onSubmit:function(e){e.preventDefault(),w.trim()&&P(w)},className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",className:"flex-1 bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 dark:placeholder-zinc-500 border border-zinc-300 dark:border-zinc-700 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/60 transition-colors",value:w,onChange:e=>j(e.target.value),placeholder:"Type your message...",disabled:N}),(0,a.jsx)("button",{type:"submit",className:"rounded-md px-4 py-3 text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 dark:hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-sm",disabled:N||!w.trim(),children:"Send"})]}),"BOOKED"===p&&f&&(0,a.jsx)(s(),{href:"/owner?lead=".concat(f),className:"block w-full text-center mt-3 rounded-md px-4 py-2 text-sm font-medium bg-green-100 dark:bg-green-900/30 text-green-900 dark:text-green-300 border border-green-300 dark:border-green-700 hover:bg-green-200 dark:hover:bg-green-900/50 transition",children:"View in dashboard →"})]}):(0,a.jsxs)("form",{onSubmit:A,className:"space-y-4 border border-zinc-200 dark:border-zinc-800 rounded-lg p-4 bg-white dark:bg-neutral-900",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Name"}),(0,a.jsx)("input",{ref:T,className:"w-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 dark:placeholder-zinc-500 border border-zinc-300 dark:border-zinc-700 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/60 transition-colors",value:r,onChange:e=>o(e.target.value),required:!0,disabled:N})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Phone number"}),(0,a.jsx)("input",{className:"w-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 dark:placeholder-zinc-500 border border-zinc-300 dark:border-zinc-700 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/60 transition-colors",value:d,onChange:e=>c(e.target.value),required:!0,disabled:N})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"What do you need done?"}),(0,a.jsx)("textarea",{className:"w-full bg-white dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 placeholder-zinc-400 dark:placeholder-zinc-500 border border-zinc-300 dark:border-zinc-700 rounded px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/60 transition-colors",rows:3,value:x,onChange:e=>h(e.target.value),required:!0,disabled:N})]}),z&&(0,a.jsx)("div",{className:"text-sm text-red-600 dark:text-red-400",children:z}),(0,a.jsx)("button",{type:"submit",className:"w-full rounded-md px-4 py-3 text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 dark:hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition shadow-sm",disabled:N,children:N?"Starting...":"Start chat with AI front desk"})]})]})})]})}},3286:(e,t,r)=>{"use strict";r.d(t,{X:()=>a});let a=!0},5241:(e,t,r)=>{Promise.resolve().then(r.bind(r,2944))},5976:(e,t,r)=>{"use strict";r.d(t,{C6:()=>l,Y9:()=>i,Zp:()=>s});var a=r(5155),n=r(2115);function o(e){let t=document.documentElement;"dark"===e?t.classList.add("dark"):t.classList.remove("dark");try{localStorage.setItem("theme",e)}catch(e){}}function s(e){let{className:t,...r}=e;return(0,a.jsx)("div",{className:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter(Boolean).join(" ")}("rounded-2xl shadow p-4 bg-white dark:bg-zinc-900 border border-neutral-200 dark:border-neutral-800 text-zinc-900 dark:text-zinc-100 transition-colors",t),...r})}function i(e){let{title:t,showThemeToggle:r=!0}=e,[s,i]=n.useState("light");return n.useEffect(()=>{let e=function(){try{let e=localStorage.getItem("theme");if("dark"===e||"light"===e)return e}catch(e){}return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}();i(e),o(e)},[]),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-100",children:null!=t?t:""}),(0,a.jsx)("div",{className:"flex items-center gap-3",children:r?(0,a.jsx)("button",{onClick:()=>{let e="dark"===s?"light":"dark";i(e),o(e)},className:"rounded-2xl px-3 py-1.5 text-sm shadow border   bg-white/70 hover:bg-white dark:bg-neutral-800/70 dark:hover:bg-neutral-800   border-neutral-200 dark:border-neutral-700   focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500","aria-label":"Toggle dark mode",children:"dark"===s?"\uD83C\uDF19 Dark":"☀️ Light"}):null})]})}function l(e){let{mode:t}=e,r="MOCK"===t;return(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)("span",{className:"inline-block px-3 py-1 rounded-full text-xs font-semibold ".concat(r?"bg-yellow-100 text-yellow-800 border border-yellow-300":"bg-green-100 text-green-800 border border-green-300"),children:[t," MODE"]})})}r(2619)}},e=>{e.O(0,[619,907,441,255,358],()=>e(e.s=5241)),_N_E=e.O()}]);